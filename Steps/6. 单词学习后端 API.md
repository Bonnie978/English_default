### 1. æ›´æ–°ç¯å¢ƒé…ç½®ç«¯å£

```typescript
// src/config/env.ts æ›´æ–°ç«¯å£éƒ¨åˆ†
export const config = {
  // æœåŠ¡å™¨é…ç½®
  PORT: process.env.PORT || 5001, // ç«¯å£æ”¹ä¸º5001
  // å…¶ä»–é…ç½®é¡¹ä¿æŒä¸å˜...
};
```

### 2. åˆ›å»ºå•è¯æ§åˆ¶å™¨

```typescript
// src/controllers/word.controller.ts
import { Request, Response } from 'express';
import { Word } from '../models/Word';
import { LearningRecord } from '../models/LearningRecord';
import { User } from '../models/User';

// è·å–æ¯æ—¥å­¦ä¹ å•è¯
export const getDailyWords = async (req: Request, res: Response) => {
  try {
    // è·å–ä»Šå¤©çš„æ—¥æœŸ
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);
    
    // æŸ¥æ‰¾ç”¨æˆ·ä»Šæ—¥çš„å­¦ä¹ è®°å½•
    let learningRecord = await LearningRecord.findOne({
      userId: req.user._id,
      date: {
        $gte: today,
        $lt: tomorrow
      }
    });
    
    // å¦‚æœä»Šå¤©æ²¡æœ‰å­¦ä¹ è®°å½•ï¼Œåˆ›å»ºæ–°çš„
    if (!learningRecord) {
      // è·å–ç”¨æˆ·è®¾ç½®
      const user = await User.findById(req.user._id);
      const dailyWordCount = user.settings.dailyWordCount || 10;
      
      // è·å–ç”¨æˆ·å·²å­¦è¿‡çš„æ‰€æœ‰å•è¯ID
      const pastRecords = await LearningRecord.find({ userId: req.user._id });
      const learnedWordIds = new Set();
      
      pastRecords.forEach(record => {
        record.wordsList.forEach(word => {
          learnedWordIds.add(word.wordId.toString());
        });
      });
      
      // è·å–æ–°å•è¯
      const newWords = await Word.find({
        _id: { $nin: Array.from(learnedWordIds) }
      }).limit(dailyWordCount);
      
      // å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„æ–°å•è¯ï¼Œå¯ä»¥ä»å·²å­¦ä¹ ä½†æœªæŒæ¡çš„å•è¯ä¸­é€‰æ‹©
      if (newWords.length < dailyWordCount) {
        console.log(`åªæ‰¾åˆ°${newWords.length}ä¸ªæ–°å•è¯ï¼Œå°‘äºæ¯æ—¥ç›®æ ‡${dailyWordCount}ä¸ª`);
        // åœ¨å®é™…åº”ç”¨ä¸­å¯ä»¥æ·»åŠ é€»è¾‘æ¥å¤„ç†è¿™ç§æƒ…å†µ
      }
      
      // åˆ›å»ºæ–°çš„å­¦ä¹ è®°å½•
      learningRecord = new LearningRecord({
        userId: req.user._id,
        date: new Date(),
        wordsList: newWords.map(word => ({
          wordId: word._id,
          mastered: false,
          reviewCount: 0,
          lastReviewDate: null
        }))
      });
      
      await learningRecord.save();
      
      res.status(200).json({
        success: true,
        date: learningRecord.date,
        words: newWords,
        progress: {
          learned: 0,
          total: newWords.length
        }
      });
    } else {
      // è¿”å›ä»Šå¤©å·²æœ‰çš„å­¦ä¹ è®°å½•
      const wordIds = learningRecord.wordsList.map(word => word.wordId);
      const words = await Word.find({ _id: { $in: wordIds } });
      
      // è®¡ç®—å·²æŒæ¡å•è¯æ•°é‡
      const masteredCount = learningRecord.wordsList.filter(word => word.mastered).length;
      
      res.status(200).json({
        success: true,
        date: learningRecord.date,
        words: words,
        progress: {
          learned: masteredCount,
          total: words.length
        }
      });
    }
  } catch (error) {
    console.error('è·å–æ¯æ—¥å•è¯é”™è¯¯:', error);
    res.status(500).json({
      success: false,
      message: 'æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åå†è¯•'
    });
  }
};

// æ ‡è®°å•è¯ä¸ºå·²æŒæ¡
export const markWordAsMastered = async (req: Request, res: Response) => {
  try {
    const { wordId } = req.params;
    
    // è·å–ä»Šå¤©çš„æ—¥æœŸ
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);
    
    // æŸ¥æ‰¾ç”¨æˆ·ä»Šæ—¥çš„å­¦ä¹ è®°å½•
    const learningRecord = await LearningRecord.findOne({
      userId: req.user._id,
      date: {
        $gte: today,
        $lt: tomorrow
      }
    });
    
    if (!learningRecord) {
      return res.status(404).json({
        success: false,
        message: 'æœªæ‰¾åˆ°ä»Šæ—¥å­¦ä¹ è®°å½•'
      });
    }
    
    // æŸ¥æ‰¾å¹¶æ›´æ–°å•è¯çŠ¶æ€
    const wordEntry = learningRecord.wordsList.find(
      word => word.wordId.toString() === wordId
    );
    
    if (!wordEntry) {
      return res.status(404).json({
        success: false,
        message: 'è¯¥å•è¯ä¸åœ¨ä»Šæ—¥å­¦ä¹ åˆ—è¡¨ä¸­'
      });
    }
    
    // åˆ‡æ¢å·²æŒæ¡çŠ¶æ€
    wordEntry.mastered = !wordEntry.mastered;
    wordEntry.lastReviewDate = new Date();
    wordEntry.reviewCount += 1;
    
    await learningRecord.save();
    
    res.status(200).json({
      success: true,
      message: wordEntry.mastered ? 'å•è¯å·²æ ‡è®°ä¸ºå·²æŒæ¡' : 'å•è¯å·²æ ‡è®°ä¸ºæœªæŒæ¡',
      mastered: wordEntry.mastered,
      masteredAt: wordEntry.lastReviewDate
    });
  } catch (error) {
    console.error('æ ‡è®°å•è¯é”™è¯¯:', error);
    res.status(500).json({
      success: false,
      message: 'æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åå†è¯•'
    });
  }
};

// è·å–å­¦ä¹ ç»Ÿè®¡ä¿¡æ¯
export const getLearningStats = async (req: Request, res: Response) => {
  try {
    // è®¡ç®—æ€»å­¦ä¹ å•è¯æ•°
    const allRecords = await LearningRecord.find({ userId: req.user._id });
    
    // ç»Ÿè®¡æ‰€æœ‰å­¦è¿‡çš„å•è¯ï¼Œé˜²æ­¢é‡å¤è®¡ç®—
    const allLearnedWordIds = new Set();
    const masteredWordIds = new Set();
    
    allRecords.forEach(record => {
      record.wordsList.forEach(word => {
        allLearnedWordIds.add(word.wordId.toString());
        if (word.mastered) {
          masteredWordIds.add(word.wordId.toString());
        }
      });
    });
    
    // è®¡ç®—è¿ç»­å­¦ä¹ å¤©æ•°
    let streakDays = 0;
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    // æ’åºè®°å½•ï¼Œæœ€è¿‘çš„åœ¨å‰
    const sortedRecords = [...allRecords].sort((a, b) => {
      return new Date(b.date).getTime() - new Date(a.date).getTime();
    });
    
    // å¦‚æœä»Šå¤©æœ‰è®°å½•ï¼Œå¼€å§‹è®¡ç®—è¿ç»­å¤©æ•°
    const todayRecord = sortedRecords.find(record => {
      const recordDate = new Date(record.date);
      recordDate.setHours(0, 0, 0, 0);
      return recordDate.getTime() === today.getTime();
    });
    
    if (todayRecord) {
      streakDays = 1;
      let checkDate = new Date(today);
      
      // å‘å‰æ£€æŸ¥æ¯ä¸€å¤©æ˜¯å¦æœ‰è®°å½•
      for (let i = 1; i <= 365; i++) { // æœ€å¤šæ£€æŸ¥ä¸€å¹´
        checkDate.setDate(checkDate.getDate() - 1);
        
        const hasRecord = sortedRecords.some(record => {
          const recordDate = new Date(record.date);
          recordDate.setHours(0, 0, 0, 0);
          return recordDate.getTime() === checkDate.getTime();
        });
        
        if (hasRecord) {
          streakDays++;
        } else {
          break;
        }
      }
    }
    
    // æ›´æ–°ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯
    const user = await User.findById(req.user._id);
    user.learningStats.totalWordsLearned = allLearnedWordIds.size;
    user.learningStats.streakDays = streakDays;
    await user.save();
    
    res.status(200).json({
      success: true,
      stats: {
        totalWordsLearned: allLearnedWordIds.size,
        masteredWords: masteredWordIds.size,
        streakDays: streakDays,
        totalExercises: user.learningStats.totalExercises
      }
    });
  } catch (error) {
    console.error('è·å–å­¦ä¹ ç»Ÿè®¡é”™è¯¯:', error);
    res.status(500).json({
      success: false,
      message: 'æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åå†è¯•'
    });
  }
};
```

### 3. åˆ›å»ºå•è¯è·¯ç”±

```typescript
// src/routes/word.routes.ts
import { Router } from 'express';
import { getDailyWords, markWordAsMastered, getLearningStats } from '../controllers/word.controller';
import { authenticate } from '../middleware/auth.middleware';

const router = Router();

// æ‰€æœ‰è·¯ç”±éƒ½éœ€è¦èº«ä»½éªŒè¯
router.use(authenticate);

// è·å–æ¯æ—¥å•è¯
router.get('/daily', getDailyWords);

// æ ‡è®°å•è¯ä¸ºå·²æŒæ¡/æœªæŒæ¡
router.post('/:wordId/mastered', markWordAsMastered);

// è·å–å­¦ä¹ ç»Ÿè®¡ä¿¡æ¯
router.get('/stats', getLearningStats);

export default router;
```

### 4. æ›´æ–°åº”ç”¨å…¥å£æ–‡ä»¶ï¼Œæ·»åŠ å•è¯è·¯ç”±

```typescript
// src/index.ts æ›´æ–°
import express from 'express';
import cors from 'cors';
import { config } from './config/env';
import { connectMongoDB } from './config/database';
import { connectRedis } from './config/redis';
import authRoutes from './routes/auth.routes';
import wordRoutes from './routes/word.routes'; // æ·»åŠ å•è¯è·¯ç”±

// åˆå§‹åŒ–Expressåº”ç”¨
const app = express();

// ä¸­é—´ä»¶
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.use(cors({
  origin: config.CORS_ORIGIN,
  credentials: true
}));

// è¿æ¥æ•°æ®åº“
(async () => {
  await connectMongoDB();
  await connectRedis();
})();

// è·¯ç”±
app.get('/', (req, res) => {
  res.json({ message: 'Welcome to Vocabulary App API' });
});

// æ·»åŠ APIè·¯ç”±
app.use('/api/auth', authRoutes);
app.use('/api/words', wordRoutes); // æ·»åŠ å•è¯è·¯ç”±

// å¯åŠ¨æœåŠ¡å™¨
app.listen(config.PORT, () => {
  console.log(`ğŸš€ Server running on port ${config.PORT} in ${config.NODE_ENV} mode`);
});
```

### 5. åˆ›å»ºæ•°æ®å¡«å……è„šæœ¬ï¼ˆç”¨äºæµ‹è¯•ï¼‰

```typescript
// scripts/seedWords.ts
import mongoose from 'mongoose';
import { connectMongoDB } from '../src/config/database';
import { Word } from '../src/models/Word';
import { config } from '../src/config/env';

// ç¤ºä¾‹å•è¯æ•°æ®
const sampleWords = [
  {
    spelling: "diligent",
    pronunciation: "/ËˆdÉªlÉªdÊ’É™nt/",
    partOfSpeech: "adj.",
    definitions: ["å‹¤å‹‰çš„ï¼Œå‹¤å¥‹çš„"],
    examples: ["She is a diligent student who always completes her homework."],
    difficulty: 3,
    tags: ["personality"]
  },
  {
    spelling: "collaborate",
    pronunciation: "/kÉ™ËˆlÃ¦bÉ™reÉªt/",
    partOfSpeech: "v.",
    definitions: ["åˆä½œï¼Œåä½œ"],
    examples: ["Our teams will collaborate on this project to ensure its success."],
    difficulty: 3,
    tags: ["work"]
  },
  {
    spelling: "perseverance",
    pronunciation: "/ËŒpÉœËsÉªËˆvÉªÉ™rÉ™ns/",
    partOfSpeech: "n.",
    definitions: ["æ¯…åŠ›ï¼ŒåšæŒä¸æ‡ˆ"],
    examples: ["His perseverance in the face of obstacles was admirable."],
    difficulty: 4,
    tags: ["personality"]
  },
  {
    spelling: "implement",
    pronunciation: "/ËˆÉªmplÉªment/",
    partOfSpeech: "v.",
    definitions: ["å®æ–½ï¼Œæ‰§è¡Œ"],
    examples: ["We need to implement the new policy by next month."],
    difficulty: 3,
    tags: ["work"]
  },
  {
    spelling: "perspective",
    pronunciation: "/pÉ™ËˆspektÉªv/",
    partOfSpeech: "n.",
    definitions: ["è§‚ç‚¹ï¼Œçœ‹æ³•"],
    examples: ["From my perspective, this solution seems the most effective."],
    difficulty: 3,
    tags: ["abstract"]
  },
  {
    spelling: "accomplish",
    pronunciation: "/É™ËˆkÊŒmplÉªÊƒ/",
    partOfSpeech: "v.",
    definitions: ["å®Œæˆï¼Œå®ç°"],
    examples: ["She accomplished all her goals before the deadline."],
    difficulty: 3,
    tags: ["achievement"]
  },
  {
    spelling: "innovative",
    pronunciation: "/ËˆÉªnÉ™veÉªtÉªv/",
    partOfSpeech: "adj.",
    definitions: ["åˆ›æ–°çš„ï¼Œé©æ–°çš„"],
    examples: ["The company is known for its innovative approach to problem-solving."],
    difficulty: 3,
    tags: ["technology"]
  },
  {
    spelling: "resilient",
    pronunciation: "/rÉªËˆzÉªliÉ™nt/",
    partOfSpeech: "adj.",
    definitions: ["æœ‰å¼¹æ€§çš„ï¼Œèƒ½æ¢å¤çš„"],
    examples: ["Children are often more resilient than adults when facing challenges."],
    difficulty: 4,
    tags: ["personality"]
  },
  {
    spelling: "enhance",
    pronunciation: "/ÉªnËˆhÉ‘Ëns/",
    partOfSpeech: "v.",
    definitions: ["æé«˜ï¼Œå¢å¼º"],
    examples: ["Regular exercise can enhance your overall well-being."],
    difficulty: 3,
    tags: ["improvement"]
  },
  {
    spelling: "substantial",
    pronunciation: "/sÉ™bËˆstÃ¦nÊƒÉ™l/",
    partOfSpeech: "adj.",
    definitions: ["å¤§é‡çš„ï¼Œå®è´¨æ€§çš„"],
    examples: ["The project requires a substantial investment of time and resources."],
    difficulty: 3,
    tags: ["quantity"]
  }
];

// å¡«å……æ•°æ®å‡½æ•°
const seedWords = async () => {
  try {
    // è¿æ¥æ•°æ®åº“
    await connectMongoDB();
    
    // æ¸…ç©ºç°æœ‰å•è¯é›†åˆï¼ˆè°¨æ…ä½¿ç”¨ï¼ä»…ç”¨äºå¼€å‘ï¼‰
    await Word.deleteMany({});
    console.log('å·²æ¸…ç©ºå•è¯é›†åˆ');
    
    // æ’å…¥ç¤ºä¾‹å•è¯
    await Word.insertMany(sampleWords);
    console.log(`å·²æ’å…¥ ${sampleWords.length} ä¸ªå•è¯`);
    
    // æ–­å¼€è¿æ¥
    await mongoose.disconnect();
    console.log('æ•°æ®åº“è¿æ¥å·²å…³é—­');
    
    process.exit(0);
  } catch (error) {
    console.error('å¡«å……æ•°æ®é”™è¯¯:', error);
    process.exit(1);
  }
};

// æ‰§è¡Œå¡«å……
seedWords();
```

### éªŒè¯æ­¥éª¤

1. **å…ˆå¡«å……å•è¯æ•°æ®**:
```bash
# æ·»åŠ è¿è¡Œè„šæœ¬åˆ°package.json
# "scripts": {
#   "seed:words": "ts-node scripts/seedWords.ts"
# }

npm run seed:words
```
é¢„æœŸç»“æœ: æ§åˆ¶å°æ˜¾ç¤ºå·²æˆåŠŸæ’å…¥10ä¸ªå•è¯

2. **å¯åŠ¨æœåŠ¡å™¨**:
```bash
npm run dev  # åº”è¯¥ç›‘å¬5001ç«¯å£
```

3. **æ³¨å†Œæˆ–ç™»å½•ç”¨æˆ·**:
```bash
curl -X POST http://localhost:5001/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","email":"test@example.com","password":"password123"}'
```
ä¿å­˜è¿”å›çš„token

4. **è·å–æ¯æ—¥å•è¯**:
```bash
curl -X GET http://localhost:5001/api/words/daily \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```
é¢„æœŸç»“æœ: è¿”å›10ä¸ªå•è¯åˆ—è¡¨å’Œå­¦ä¹ è¿›åº¦

5. **æ ‡è®°å•è¯ä¸ºå·²æŒæ¡**:
```bash
curl -X POST http://localhost:5001/api/words/WORD_ID_HERE/mastered \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```
é¢„æœŸç»“æœ: è¿”å›æˆåŠŸä¿¡æ¯å’Œæ›´æ–°åçš„æŒæ¡çŠ¶æ€

6. **è·å–å­¦ä¹ ç»Ÿè®¡ä¿¡æ¯**:
```bash
curl -X GET http://localhost:5001/api/words/stats \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```
é¢„æœŸç»“æœ: è¿”å›å­¦ä¹ ç»Ÿè®¡æ•°æ®ï¼ŒåŒ…æ‹¬æ€»å•è¯æ•°ã€å·²æŒæ¡å•è¯æ•°å’Œè¿ç»­å­¦ä¹ å¤©æ•°
